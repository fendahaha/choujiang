<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="/static/js/jquery/3.7.1/jquery.min.js"></script>
    <link rel="stylesheet" href="/static/css/common.css">
    <style>
        .main {
            width: 500px;
            height: 400px;
            background-color: rgba(0, 0, 0, 1);
            position: relative;
            margin: 0 auto;
            overflow: hidden;
        }
    </style>
</head>
<body>
<script>
    const firworks_animation = {
        firworks_parent: document.querySelector(".main"),
        randomColor: function () {
            let color = "rgb("
            let r = parseInt(Math.random() * 256);
            let g = parseInt(Math.random() * 256);
            let b = parseInt(Math.random() * 256);
            color = color + r + "," + g + "," + b + ")";
            return color;
        },
        create_div: function (x, y) {
            let div = document.createElement("div");
            div.style.backgroundColor = this.randomColor();
            div.style.width = '4px';
            div.style.height = '4px';
            div.style.position = 'absolute';
            div.style.left = x + "px";
            div.style.top = y + "px";
            this.firworks_parent.appendChild(div);
            return div
        },
        generate_speed: function () {
            let x = (parseInt(Math.random() * 2) == 0 ? 1 : -1) * parseInt(Math.random() * 16 + 1);
            let y = (parseInt(Math.random() * 2) == 0 ? 1 : -1) * parseInt(Math.random() * 20 + 1);
            return {x, y}
        },
        run: function (x, y) {
            $(".main").remove();
            $("body").append(`<div class="main"></div>`);
            this.firworks_parent = $(".main")[0];

            const _this = this;
            let items = [];
            let speeds = [];
            [...Array(200).keys()].forEach(i => {
                items.push(_this.create_div(x, y));
                speeds.push(_this.generate_speed());
            })
            requestAnimationFrame(function () {
                requestAnimationFrame(function () {
                    let i = 3;
                    const intervalId = setInterval(() => {
                        i++;
                        let indexs = [];
                        items.forEach((div, index) => {
                            const speed = speeds[index];
                            div.style.left = parseInt(div.style.left) + speed.x + "px";
                            //当i+speedY>0时,烟花朝下运动。
                            div.style.top = parseInt(div.style.top) + speed.y + i + "px";
                            let left = parseInt(div.style.left);
                            let top = parseInt(div.style.top);
                            if (left > _this.firworks_parent.offsetWidth
                                || top > _this.firworks_parent.offsetHeight
                                || left < 2
                                || top < 2) {
                                div.remove();
                                indexs.push(index);
                            }
                        })
                        items = items.filter((e, i) => {
                            return !indexs.includes(i);
                        })
                        speeds = speeds.filter((e, i) => {
                            return !indexs.includes(i);
                        })
                        if (items.length <= 0) {
                            clearInterval(intervalId);
                            $(".main").remove();
                        }
                    }, 30)
                })
            })
        },
    }

    document.querySelector("body").onclick = function (event) {
        const e = event || window.event;
        const x = 300;
        const y = 200;
        console.log(x,y);
        firworks_animation.run(x, y);
    }

</script>
</body>
</html>